// knockout-arraytransforms 0.4.1 (https://github.com/mwiencek/knockout-arrayTransforms)
// Released under the MIT (X11) License; see the LICENSE file in the official code repository.
!function(a){"undefined"!=typeof module&&void 0!==module.exports?a(module.exports=require("knockout")):"function"==typeof define&&define.amd?define(["knockout"],a):a(window.ko)}(function(a){function b(b){var f=this.mappedItems,h=g(),j=0;c(this);for(var k,l=0;k=b[l];l++){var m=k.status;if("retained"!==m){var n=k.index,o=k.moved,p=k.value,q=k.mappedItem;if(void 0!==o){if("added"===m)var r=n,s=o+j;else if("deleted"===m)var r=o,s=n+j;void 0===h[r]&&(h[r]=!0,r!==s&&(q=f[s],f.splice(s,1),f.splice(r,0,q),this.valueMoved(p,r,s,q.mappedValue,q),q.index(r),r>s?e(f,s,r-1,-1):e(f,r+1,s,1)))}"added"===m?(void 0===o&&(q=g(),q.index=a.observable(n),q.value=p,i(this,q),f.splice(n,0,q),this.valueAdded(p,n,q.mappedValue,q),e(f,n+1,f.length-1,1)),j++):"deleted"===m&&(void 0===o&&(q=f.splice(n+j,1)[0],q.computed&&q.computed.dispose(),this.valueDeleted(p,n+j,q.mappedValue,q),e(f,n+j,f.length-1,-1)),j--)}}d(this)}function c(a){var b=a.transformedArray;b&&0===a.mutationDepth++&&(a.previousArray=b.concat())}function d(a){var b=a.transformedArray;if(b&&0===--a.mutationDepth){var c=s(a.previousArray,b,{sparse:!0});a.transform.notifySubscribers(b),a.transform.notifySubscribers(c,r),a.previousArray=null}}function e(a,b,c,d){for(;c>=b;){var e=a[b++];e.index(e.index.peek()+d)}}function f(a,b,c,d){var e=a.transformedArray;(d!==e[c]||b!==c)&&(e.splice(c,1),e.splice(b,0,d))}function g(){return Object.create?Object.create(null):{}}function h(a,b){return a===b}function i(b,c){var d=b.callback;if(void 0===d)return void(c.mappedValue=c.value);var e=b,f="callback";if("function"!=typeof d){if(e=c.value,f=d,d=e[f],"function"!=typeof d)return void(c.mappedValue=d);if(a.isObservable(d))return void j(b,c,d)}var g=a.computed(function(){return e[f](c.value,c.index)});return g.isActive()?(g.equalityComparer=h,j(b,c,g),c.computed=g,g):void(c.mappedValue=g.peek())}function j(a,b,e){b.mappedValue=e.peek(),e.subscribe(function(e){c(a),a.valueMutated(b.value,e,b.mappedValue,b),b.mappedValue=e,d(a)})}function k(a){this.applyChanges(a)}function l(b,c,d,e){b.original=c,b.mappedItems=[],b.callback=d,b.mutationDepth=0;var f=b.init(e);b.transform=f,a.isObservable(f)&&f.cacheDiffForKnownOperation&&(f.subscribe=a.observableArray.fn.subscribe,b.transformedArray=f.peek())}function m(c){function d(a,b,c){l(this,a,b,c)}d.prototype.applyChanges=b,a.utils.extend(d.prototype,c),q[c.name]=d,a.observableArray.fn[c.name]=function(a,b){var c=new d(this,a,b),e=this.peek(),f=[];this.subscribe(k,c,r);for(var g=0,h=e.length;h>g;g++)f.push({status:"added",value:e[g],index:g});return c.applyChanges(f),c.transform}}function n(a,b,c,d){var e,f=0;return d>0&&(e=b[d-1],f=e[c]||0,a.getVisibility(e.mappedValue)&&f++),f}function o(a){return!a}function p(a){return a+""===this.groupKey}var q=g(),r="arrayChange",s=a.utils.compareArrays;m({name:"sortBy",init:function(){return this.keyCounts=g(),this.sortedItems=[],a.observableArray([])},valueAdded:function(a,b,c,d){var e=this.sortedIndexOf(c,a,d),f=this.sortedItems,g=this.keyCounts;d.mappedIndex=e,f.splice(e,0,d),g[c]=(g[c]||0)+1;for(var h=e+1,i=f.length;i>h;h++)f[h].mappedIndex++;this.transformedArray.splice(e,0,a)},valueDeleted:function(a,b,c,d){var e=d.mappedIndex,f=this.sortedItems;f.splice(e,1),this.keyCounts[c]--;for(var g=e,h=f.length;h>g;g++)f[g].mappedIndex--;this.transformedArray.splice(e,1)},valueMoved:function(a,b,c,d,e){var f=e.mappedIndex,g=this.sortedIndexOf(d,a,e);f!==g&&this.moveValue(a,d,f,g,e)},valueMutated:function(a,b,c,d){var e=d.mappedIndex,f=this.sortedIndexOf(b,a,d);if(f>e&&f--,e!==f){this.moveValue(a,b,e,f,d);var g=this.keyCounts;g[c]--,g[b]=(g[b]||0)+1}},moveValue:function(a,b,c,d,e){var g=this.sortedItems;if(g.splice(c,1),g.splice(d,0,e),e.mappedIndex=d,d>c)for(var h=c;d>h;h++)g[h].mappedIndex--;else for(var h=d+1;c>=h;h++)g[h].mappedIndex++;f(this,d,c,a)},sortedIndexOf:function(a,b,c){var d=this.sortedItems,e=d.length;if(!e)return 0;for(var f,g=0,h=e-1;h>=g;)if(f=g+h>>1,a>d[f].mappedValue)g=f+1;else if((h=f)===g)break;var i=this.keyCounts[a],j=0;if(i)for(var k,l=this.mappedItems,m=0;e>m&&(k=l[m],k!==c)&&(k.mappedValue===a&&j++,j!==i);m++);return g+j}});var t={mappedIndexProp:"mappedIndex",init:function(){return a.observableArray([])},valueAdded:function(a,b,c,d){var e=this.mappedItems,f=this.mappedIndexProp,g=n(this,e,f,b);if(d[f]=g,this.getVisibility(c)){for(var h=b+1,i=e.length;i>h;h++)e[h][f]++;this.transformedArray.splice(g,0,a)}},valueDeleted:function(a,b,c,d){if(this.getVisibility(c)){var e=this.mappedItems,f=this.mappedIndexProp;e[b]===d&&b++;for(var g=b,h=e.length;h>g;g++)e[g][f]--;this.transformedArray.splice(d[f],1)}},valueMoved:function(a,b,c,d,e){var g=this.mappedItems,h=this.mappedIndexProp,i=e[h],j=n(this,g,h,b);if(b>c&&j--,e[h]=j,this.getVisibility(d)){if(b>c)for(var k=c;b>k;k++)g[k][h]--;else for(var k=b+1;c>=k;k++)g[k][h]++;f(this,j,i,a)}},valueMutated:function(a,b,c,d){var e=d.index.peek();this.valueAdded(a,e,b,d),this.valueDeleted(a,e,c,d)}};m(a.utils.extend({name:"filter",getVisibility:Boolean},t)),m(a.utils.extend({name:"reject",getVisibility:o},t)),m({name:"groupBy",init:function(){return this.groups=g(),a.observableArray([])},applyChanges:function(a){var e=this.groups;for(var f in e)c(e[f]);b.call(this,a);for(f in e)d(e[f]),e[f].transformedArray.length||this.deleteGroup(f)},valueAdded:function(a,b,d,e){d+="";var f=this.groups;if(!f[d]){var h=new q.filter(this.original);f[d]=h,h.groupKey=d,h.mappedItems=this.mappedItems,h.mappedIndexProp="mappedIndex."+d,h.getVisibility=p,c(h);var i=g();i.key=d,i.values=h.transform,this.transformedArray.push(i)}for(var j in f)f[j].valueAdded(a,b,d,e)},valueDeleted:function(a,b,c,d){var e=this.groups;for(var f in e)e[f].valueDeleted(a,b,c,d)},valueMoved:function(a,b,c,d,e){var f=this.groups;for(var g in f)f[g].valueMoved(a,b,c,d,e)},valueMutated:function(a,b,c,d){var e,f=this.groups,g=d.index.peek();for(var h in f)e=f[h],e.valueDeleted(a,g,c,d),e.valueAdded(a,g,b,d),e.transformedArray.length||this.deleteGroup(h)},deleteGroup:function(a){var b=this.transformedArray;delete this.groups[a];for(var c=0,d=b.length;d>c;c++)if(b[c].key===a)return b.splice(c,1)}}),m({name:"map",init:function(){return a.observableArray([])},valueAdded:function(a,b,c){this.transformedArray.splice(b,0,c)},valueDeleted:function(a,b){this.transformedArray.splice(b,1)},valueMoved:function(a,b,c,d){f(this,b,c,d)},valueMutated:function(a,b,c,d){var e=d.index.peek();f(this,e,e,b)}});var u={init:function(){return this.truthinessCount=0,a.observable(this.getTruthiness())},valueAdded:function(a,b,c){this.valueMutated(null,c,!1)},valueDeleted:function(a,b,c){this.valueMutated(null,!1,c)},valueMoved:function(){},valueMutated:function(a,b,c){b&&!c?this.truthinessCount++:c&&!b&&this.truthinessCount--,this.transform(this.getTruthiness())}};m(a.utils.extend({name:"any",getTruthiness:function(){return this.truthinessCount>0}},u)),m(a.utils.extend({name:"all",getTruthiness:function(){return this.truthinessCount===this.mappedItems.length}},u)),a.observableArray.fn.some=a.observableArray.fn.any,a.observableArray.fn.every=a.observableArray.fn.all,a.arrayTransforms={makeTransform:m}});