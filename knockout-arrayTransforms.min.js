// knockout-arraytransforms 0.5.3 (https://github.com/mwiencek/knockout-arrayTransforms)
// Released under the MIT (X11) License; see the LICENSE file in the official code repository.
!function(a){"undefined"!=typeof module&&void 0!==module.exports?module.exports=a(require("knockout")):"function"==typeof define&&define.amd?define(["knockout"],a):a(window.ko)}(function(a){function b(b){for(var e,g=this.mappedItems,i=d(),j=0,k=0,l=0;e=b[l];l++){var m=e.status;if("retained"!==m){var n=e.index,o=e.moved,p=e.value,q=void 0!==o,r=null;if(j=Math.min(j,n),"added"===m){var s=o+k;q?(r=i[n],r||(r=i[n]=g[s],g[s]=null)):(r=d(),r.index=a.observable(n),r.index.isDifferent=f,r.value=p,h(this,r)),g.splice(n,0,r),this.valueAdded(p,n,r.mappedValue,r,q),k++}else if("deleted"===m){var s=n+k;q?r=i[o]||(i[o]=g[s]):(r=g[s],r.computed&&r.computed.dispose()),g.splice(s,1),this.valueDeleted(p,s,r.mappedValue,r,q),k--}}}for(var r,l=j,t=g.length;t>l;l++)g[l].index(l);c(this)}function c(a){var b=a.transformedArray;if(b){var c=r(a.previousArray,b,{sparse:!0});if(c.length){a.previousArray=b.concat();var d=a.original,e=d.notifySubscribers,f=d.peek().concat(),g=!1;d.notifySubscribers=function(a,b){"arrayChange"===b?g=!0:e.apply(d,arguments)},a.transform.notifySubscribers(b),a.transform.notifySubscribers(c,q),d.notifySubscribers=e,g&&(c=r(f,d.peek(),{sparse:!0}),c.length&&d.notifySubscribers(c,"arrayChange"))}}}function d(){return Object.create?Object.create(null):{}}function e(a,b){return a===b}function f(a,b){return a!==b}function g(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1}function h(b,c){var d=b.callback;if(void 0===d)return void(c.mappedValue=c.value);var f=b,g="callback";if("function"!=typeof d){if(f=c.value,g=d,d=f[g],"function"!=typeof d)return void(c.mappedValue=d);if(a.isObservable(d))return void i(b,c,d)}var h=a.computed(function(){return f[g](c.value,c.index)});return h.isActive()?(h.equalityComparer=e,i(b,c,h),c.computed=h,h):void(c.mappedValue=h.peek())}function i(a,b,d){b.mappedValue=d.peek(),d.subscribe(function(d){a.valueMutated(b.value,d,b.mappedValue,b),b.mappedValue=d,c(a)})}function j(a){this.applyChanges(a)}function k(b,c,d,e){b.original=c,b.mappedItems=[],b.callback=d;var f=b.init(e);b.transform=f,a.isObservable(f)&&f.cacheDiffForKnownOperation&&(f.subscribe=a.observableArray.fn.subscribe,b.transformedArray=f.peek(),b.previousArray=b.transformedArray.concat())}function l(c){function d(a,b,c){k(this,a,b,c)}d.prototype.applyChanges=b,a.utils.extend(d.prototype,c),p[c.name]=d,a.observableArray.fn[c.name]=function(a,b){var c=new d(this,a,b),e=this.peek(),f=[];this.subscribe(j,c,q);for(var g=0,h=e.length;h>g;g++)f.push({status:"added",value:e[g],index:g});return c.applyChanges(f),c.transform}}function m(a,b,c,d){var e,f=0;return d>0&&(e=b[d-1],f=e[c]||0,a.getVisibility(e.mappedValue)&&f++),f}function n(a){return!a}function o(a){return a+""===this.groupKey}var p=d(),q="arrayChange",r=a.utils.compareArrays;l({name:"sortBy",init:function(){return this.keyCounts=d(),this.sortedItems=[],a.observableArray([])},valueAdded:function(a,b,c,d,e){var f=this.sortedIndexOf(c,a,d),h=this.sortedItems;if(e){var i=g(h,d);i>=0&&(i>=f&&i++,d.previousMappedIndex=i)}var j=this.keyCounts;h.splice(f,0,d),j[c]=(j[c]||0)+1,this.transformedArray.splice(f,0,a)},valueDeleted:function(a,b,c,d,e){var f,h=this.sortedItems;e&&void 0!==d.previousMappedIndex?(f=d.previousMappedIndex,delete d.previousMappedIndex):f=g(h,d),h.splice(f,1),this.keyCounts[c]--,this.transformedArray.splice(f,1)},valueMutated:function(a,b,c,d){var e=this.keyCounts,f=g(this.sortedItems,d),h=this.sortedIndexOf(b,a,d);if(e[c]--,e[b]=(e[b]||0)+1,h>f&&h--,f!==h){var i=this.transformedArray,j=this.sortedItems;j.splice(f,1),j.splice(h,0,d),i.splice(f,1),i.splice(h,0,a)}},sortedIndexOf:function(a,b,c){var d=this.sortedItems,e=d.length;if(!e)return 0;for(var f,g=0,h=e-1;h>=g;)if(f=g+h>>1,a>d[f].mappedValue)g=f+1;else if((h=f)===g)break;var i=this.keyCounts[a],j=0;if(i)for(var k,l=this.mappedItems,m=0;e>m;m++)if(k=l[m]){if(k===c)break;if(k.mappedValue===a&&j++,j===i)break}return g+j}});var s={mappedIndexProp:"mappedIndex",init:function(){return a.observableArray([])},valueAdded:function(a,b,c,d){c=this.getVisibility(c);var e=this.mappedItems,f=this.mappedIndexProp;if(c)for(var g,h=b+1,i=e.length;i>h;h++)(g=e[h])&&g[f]++;var j=m(this,e,f,b);c&&this.transformedArray.splice(j,0,a),d[f]=j},valueDeleted:function(a,b,c,d){if(this.getVisibility(c)){var e=this.mappedItems,f=this.mappedIndexProp,g=m(this,e,f,b);e[b]===d&&b++;for(var h,i=b,j=e.length;j>i;i++)(h=e[i])&&h[f]--;this.transformedArray.splice(g,1)}},valueMutated:function(a,b,c,d){var e=g(this.mappedItems,d);this.valueAdded(a,e,b,d),this.valueDeleted(a,e,c,d)}};l(a.utils.extend({name:"filter",getVisibility:Boolean},s)),l(a.utils.extend({name:"reject",getVisibility:n},s)),l({name:"groupBy",init:function(){return this.groups=d(),a.observableArray([])},applyChanges:function(a){var d=this.groups;b.call(this,a);var e=!1;for(key in d)c(d[key]),d[key].transformedArray.length||(this.deleteGroup(key),e=!0);e&&c(this)},valueAdded:function(a,b,c,e){c+="";var f=this.groups;if(!f[c]){var g=new p.filter(this.original);f[c]=g,g.groupKey=c,g.mappedItems=this.mappedItems,g.mappedIndexProp="mappedIndex."+c,g.getVisibility=o;var h=d();h.key=c,h.values=g.transform,this.transformedArray.push(h)}for(var i in f)f[i].valueAdded(a,b,c,e)},valueDeleted:function(a,b,c,d){var e=this.groups;for(var f in e)e[f].valueDeleted(a,b,c,d)},valueMutated:function(a,b,d,e){var f,h=this.groups,i=g(this.mappedItems,e);this.valueDeleted(a,i,d,e),this.valueAdded(a,i,b,e);for(var j in h)f=h[j],c(f),f.transformedArray.length||this.deleteGroup(j)},deleteGroup:function(a){var b=this.transformedArray;delete this.groups[a];for(var c=0,d=b.length;d>c;c++)if(b[c].key===a)return b.splice(c,1)}}),l({name:"map",init:function(){return a.observableArray([])},valueAdded:function(a,b,c){this.transformedArray.splice(b,0,c)},valueDeleted:function(a,b){this.transformedArray.splice(b,1)},valueMutated:function(a,b,c,d){this.transformedArray[g(this.mappedItems,d)]=b}});var t={init:function(){return this.truthinessCount=0,a.observable(this.getTruthiness())},valueAdded:function(a,b,c){this.valueMutated(null,c,!1)},valueDeleted:function(a,b,c){this.valueMutated(null,!1,c)},valueMutated:function(a,b,c){b&&!c?this.truthinessCount++:c&&!b&&this.truthinessCount--,this.transform(this.getTruthiness())}};return l(a.utils.extend({name:"any",getTruthiness:function(){return this.truthinessCount>0}},t)),l(a.utils.extend({name:"all",getTruthiness:function(){return this.truthinessCount===this.mappedItems.length}},t)),a.observableArray.fn.some=a.observableArray.fn.any,a.observableArray.fn.every=a.observableArray.fn.all,a.arrayTransforms={makeTransform:l}});