// knockout-arraytransforms 0.4.0 (https://github.com/mwiencek/knockout-arrayTransforms)
// Released under the MIT (X11) License; see the LICENSE file in the official code repository.
!function(a){"undefined"!=typeof module&&void 0!==module.exports?a(module.exports=require("knockout")):"function"==typeof define&&define.amd?define(["knockout"],a):a(window.ko)}(function(a){function b(b){for(var d,e=this.mappedItems,f=g(),h=0,i=0;d=b[i];i++){var k=d.status;if("retained"!==k){var l=d.index,m=d.moved,n=d.value,o=d.mappedItem;if(void 0!==m){if("added"===k)var p=l,q=m+h;else if("deleted"===k)var p=m,q=l+h;void 0===f[p]&&(f[p]=!0,p!==q&&(o=e[q],e.splice(q,1),e.splice(p,0,o),this.valueMoved(n,p,q,o.mappedValue,o),o.index(p),p>q?c(e,q,p-1,-1):c(e,p+1,q,1)))}"added"===k?(void 0===m&&(o=g(),o.index=a.observable(l),o.value=n,j(this,o),e.splice(l,0,o),this.valueAdded(n,l,o.mappedValue,o),c(e,l+1,e.length-1,1)),h++):"deleted"===k&&(void 0===m&&(o=e.splice(l+h,1)[0],o.computed&&o.computed.dispose(),this.valueDeleted(n,l+h,o.mappedValue,o),c(e,l+h,e.length-1,-1)),h--)}}}function c(a,b,c,d){for(;c>=b;){var e=a[b++];e.index(e.index.peek()+d)}}function d(a,b,c){var d=a.transform,e=a.transformedArray;e.splice(b,0,c),d.notifySubscribers(e),d.notifySubscribers([{status:"added",index:b,value:c}],p)}function e(a,b,c){var d=a.transform,e=a.transformedArray;e.splice(b,1),d.notifySubscribers(e),d.notifySubscribers([{status:"deleted",index:b,value:c}],p)}function f(a,b,c,d){var e=a.transformedArray,f=e[c];if(d!==f||b!==c){var g=a.transform;e.splice(c,1),e.splice(b,0,d),g.notifySubscribers(e);var h={status:"deleted",index:c,value:f},i={status:"added",index:b,value:d};d===f&&(h.moved=b,i.moved=c),g.notifySubscribers([h,i],p)}}function g(){return Object.create?Object.create(null):{}}function h(){}function i(a,b){return a===b}function j(b,c){var d=b.callback;if(void 0===d)return void(c.mappedValue=c.value);var e=b,f="callback";if("function"!=typeof d){if(e=c.value,f=d,d=e[f],"function"!=typeof d)return void(c.mappedValue=d);if(a.isObservable(d))return void k(b,c,d)}var g=a.computed(function(){return e[f](c.value,c.index)});return g.isActive()?(g.equalityComparer=i,k(b,c,g),c.computed=g,g):void(c.mappedValue=g.peek())}function k(a,b,c){b.mappedValue=c.peek(),c.subscribe(function(c){a.valueMutated(b.value,c,b.mappedValue,b),b.mappedValue=c})}function l(c){function d(b,c,d){this.original=b,this.mappedItems=[],this.callback=c;var e=this.transform=this.init(d);a.isObservable(e)&&e.cacheDiffForKnownOperation&&(e.subscribe=a.observableArray.fn.subscribe,this.transformedArray=e.peek())}d.prototype.applyChanges=b,a.utils.extend(d.prototype,c),o[c.name]=d,a.observableArray.fn[c.name]=function(a,b){var c=new d(this,a,b),e=this.peek(),f=[];this.subscribe(function(a){c.applyChanges(a)},null,p);for(var g=0,h=e.length;h>g;g++)f.push({status:"added",value:e[g],index:g});return c.applyChanges(f),c.transform}}function m(a,b,c,d){var e,f=0;return d>0&&(e=b[d-1],f=e[c]||0,a.getVisibility(e.mappedValue)&&f++),f}function n(a){return a+""===this.groupKey}var o=g(),p="arrayChange";l({name:"sortBy",init:function(){return this.keyCounts=g(),this.sortedItems=[],a.observableArray([])},valueAdded:function(a,b,c,e){var f=this.sortedIndexOf(c,a,e),g=this.sortedItems,h=this.keyCounts;e.mappedIndex=f,g.splice(f,0,e),h[c]=(h[c]||0)+1;for(var i=f+1,j=g.length;j>i;i++)g[i].mappedIndex++;d(this,f,a)},valueDeleted:function(a,b,c,d){var f=d.mappedIndex,g=this.sortedItems;g.splice(f,1),this.keyCounts[c]--;for(var h=f,i=g.length;i>h;h++)g[h].mappedIndex--;e(this,f,a)},valueMoved:function(a,b,c,d,e){var f=e.mappedIndex,g=this.sortedIndexOf(d,a,e);f!==g&&this.moveValue(a,d,f,g,e)},valueMutated:function(a,b,c,d){var e=d.mappedIndex,f=this.sortedIndexOf(b,a,d);if(e!==f){this.moveValue(a,b,e,f,d,!0);var g=this.keyCounts;g[c]--,g[b]=(g[b]||0)+1}},moveValue:function(a,b,c,d,e,g){var h=this.sortedItems;if(g&&d>c&&d--,h.splice(c,1),h.splice(d,0,e),e.mappedIndex=d,d>c)for(var i=c;d>i;i++)h[i].mappedIndex--;else for(var i=d+1;c>=i;i++)h[i].mappedIndex++;f(this,d,c,a)},sortedIndexOf:function(a,b,c){var d=this.sortedItems,e=d.length;if(!e)return 0;for(var f,g=0,h=e-1;h>=g;)if(f=g+h>>1,a>d[f].mappedValue)g=f+1;else if((h=f)===g)break;var i=this.keyCounts[a],j=0;if(i)for(var k,l=this.mappedItems,m=0;e>m&&(k=l[m],k!==c)&&(k.mappedValue===a&&j++,j!==i);m++);return g+j}}),l({name:"filter",mappedIndexProp:"mappedIndex",init:function(){return a.observableArray([])},valueAdded:function(a,b,c,e){var f=this.mappedItems,g=this.mappedIndexProp,h=m(this,f,g,b);if(e[g]=h,c){for(var i=b+1,j=f.length;j>i;i++)f[i][g]++;d(this,h,a)}},valueDeleted:function(a,b,c,d){if(c){var f=this.mappedItems,g=this.mappedIndexProp;f[b]===d&&b++;for(var h=b,i=f.length;i>h;h++)f[h][g]--;e(this,d[g],a)}},valueMoved:function(a,b,c,d,e){var g=this.mappedItems,h=this.mappedIndexProp,i=e[h],j=m(this,g,h,b);if(b>c&&j--,e[h]=j,d){if(b>c)for(var k=c;b>k;k++)g[k][h]--;else for(var k=b+1;c>=k;k++)g[k][h]++;f(this,j,i,a)}},valueMutated:function(a,b,c,d){b&&!c?this.valueAdded(a,d.index.peek(),!0,d):!b&&c&&this.valueDeleted(a,d.index.peek(),!0,d)},getVisibility:Boolean}),l({name:"groupBy",init:function(){return this.groups=g(),a.observableArray([])},applyChanges:function(a){var c=this.groups;b.call(this,a);for(var d in c)c[d].transformedArray.length||this.deleteGroup(d)},valueAdded:function(a,b,c,e){c+="";var f=this.groups;if(!f[c]){var h=new o.filter(this.original);f[c]=h,h.groupKey=c,h.mappedItems=this.mappedItems,h.mappedIndexProp="mappedIndex."+c,h.getVisibility=n;var i=g();i.key=c,i.values=h.transform,d(this,this.transformedArray.length,i)}for(var j in f)f[j].valueAdded(a,b,j===c,e)},valueDeleted:function(a,b,c,d){c+="";var e=this.groups;for(var f in e)e[f].valueDeleted(a,b,f===c,d)},valueMoved:function(a,b,c,d,e){d+="";var f=this.groups;for(var g in f)f[g].valueMoved(a,b,c,g===d,e)},valueMutated:function(a,b,c,d){b+="",c+="";var e,f=this.groups,g=d.index.peek();for(var h in f)e=f[h],e.valueDeleted(a,g,h===c,d),e.valueAdded(a,g,h===b,d),e.transformedArray.length||this.deleteGroup(h)},deleteGroup:function(a){var b=this.transformedArray;delete this.groups[a];for(var c=0,d=b.length;d>c;c++)if(b[c].key===a)return e(this,c,b[c])}}),l({name:"map",init:function(){return a.observableArray([])},valueAdded:function(a,b,c){d(this,b,c)},valueDeleted:function(a,b,c){e(this,b,c)},valueMoved:function(a,b,c,d){f(this,b,c,d)},valueMutated:function(a,b,c,d){var e=d.index.peek();f(this,e,e,b)}});var q={init:function(){return this.truthinessCount=0,a.observable(this.getTruthiness())},valueAdded:function(a,b,c){this.valueMutated(null,c,!1)},valueDeleted:function(a,b,c){this.valueMutated(null,!1,c)},valueMoved:h,valueMutated:function(a,b,c){b&&!c?this.truthinessCount++:c&&!b&&this.truthinessCount--,this.transform(this.getTruthiness())}};l(a.utils.extend({name:"any",getTruthiness:function(){return this.truthinessCount>0}},q)),l(a.utils.extend({name:"all",getTruthiness:function(){return this.truthinessCount===this.mappedItems.length}},q)),a.observableArray.fn.some=a.observableArray.fn.any,a.observableArray.fn.every=a.observableArray.fn.all,a.arrayTransforms={makeTransform:l}});