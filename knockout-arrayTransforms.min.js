// knockout-arraytransforms 0.3.0 (https://github.com/mwiencek/knockout-arrayTransforms)
// Released under the MIT (X11) License; see the LICENSE file in the official code repository.
!function(a){"undefined"!=typeof module&&void 0!==module.exports?a(module.exports=require("knockout")):"function"==typeof define&&define.amd?define(["knockout"],a):a(window.ko)}(function(a){function b(b,c){for(var d,g=e(),h=0,i=0;d=c[i];i++){var k=d.status;if("retained"!==k){var l=b.observables,m=d.index,n=d.moved,o=d.value;if(void 0!==n){if("added"===k)var p=m,q=n+h;else if("deleted"===k)var p=n,q=m+h;if(void 0===g[p]){g[p]=!0;var r=l[q];l.splice(q,1),l.splice(p,0,r),b.valueMoved(o,p,q,f(r))}}if("added"===k){if(void 0===n){var r=j(b,o,m);l.splice(m,0,r),b.valueAdded(o,m,f(r))}h++}else if("deleted"===k){if(void 0===n){var r=l.splice(m+h,1)[0];a.isComputed(r)&&r.dispose(),b.valueDeleted(o,m+h,f(r))}h--}}}}function c(a){var b=a.changes;if(b&&b.length){offset=0;for(var c,d=0;c=b[d];d++){var e=c.status;"added"===e?(void 0!==c.moved&&(c.moved-=offset),offset++):"deleted"===e&&(c.index-=offset,offset--)}var f=a.transform;f.notifySubscribers(f.peek()),f.notifySubscribers(b,"arrayChange"),a.changes=[]}}function d(a){b(this,a),c(this)}function e(){return Object.create?Object.create(null):{}}function f(a){return"function"==typeof a?a.peek():a}function g(a,b){for(var c=0,d=b.length;d>c;c++)if(b[c]===a)return c;return-1}function h(){}function i(a,b){return a===b}function j(b,c,d){var e=b.callback;if(void 0===e)return c;var f=b,h="callback";if("function"!=typeof e){if(f=c,h=e,e=f[h],"function"!=typeof e)return e;if(a.isObservable(e))return k(b,c,e),e}var j=b.original,l=a.computed(function(){return f[h](c,null===d?g(c,j.peek()):d)});return l.isActive()?(d=null,l.equalityComparer=i,k(b,c,l),l):(l.dispose(),l.peek())}function k(a,b,d){var e=d.peek();d.subscribe(function(d){a.valueMutated(b,d,e),e=d,c(a)})}function l(b){function c(b,c,d){this.original=b,this.observables=[],this.callback=c;var e=this.init(d);a.isObservable(e)&&e.cacheDiffForKnownOperation&&(this.changes=[],this.transformedArray=e.peek(),e.subscribe=a.observableArray.fn.subscribe),this.transform=e}c.prototype.applyAndNotifyChanges=d,a.utils.extend(c.prototype,b),m[b.name]=c,a.observableArray.fn[b.name]=function(a,b){var d=new c(this,a,b);this.subscribe(function(a){d.applyAndNotifyChanges(a)},null,"arrayChange");for(var e=this.peek(),f=[],g=0,h=e.length;h>g;g++)f.push({status:"added",value:e[g],index:g});return d.applyAndNotifyChanges(f),d.transform}}var m=e();l({name:"sortBy",init:function(){return this.keyCounts=e(),this.sortedKeys=[],a.observableArray([])},valueAdded:function(a,b,c){var d=this.sortedIndexOf(c,a),e=this.keyCounts;this.transformedArray.splice(d,0,a),this.sortedKeys.splice(d,0,c),e[c]=e[c]+1||1,this.changes.push({status:"added",value:a,index:d})},valueDeleted:function(a,b,c){var d=this.transformedArray,e=g(a,d);d.splice(e,1),this.sortedKeys.splice(e,1),this.keyCounts[c]--,this.changes.push({status:"deleted",value:a,index:e})},valueMoved:function(a,b,c,d){var e=g(a,this.transformedArray),f=this.sortedIndexOf(d,a);e!==f&&this.moveValue(a,d,e,f)},valueMutated:function(a,b,c){var d=g(a,this.transformedArray),e=this.sortedIndexOf(b,a);if(d!==e){this.moveValue(a,b,d,e,!0);var f=this.keyCounts;f[c]--,f[b]=f[b]+1||1}},moveValue:function(a,b,c,d,e){var f=this.transformedArray,g=this.sortedKeys;f.splice(c,1),g.splice(c,1),e&&d>c&&d--,f.splice(d,0,a),g.splice(d,0,b),this.changes.push({status:"added",index:d,moved:c,value:a},{status:"deleted",index:c,moved:d,value:a})},sortedIndexOf:function(a,b){var c=this.sortedKeys,d=c.length;if(0===d)return 0;for(var e,g=0,h=d-1;h>=g;)if(e=g+h>>1,a>c[e])g=e+1;else if(h=e,g===h)break;var i=this.keyCounts[a],j=0;if(i)for(var k=this.original.peek(),l=this.observables,m=0;d>m&&k[m]!==b&&(f(l[m])===a&&j++,j!==i);m++);return g+j}}),l({name:"filter",init:function(){return this.mappedIndexes=[],a.observableArray([])},valueAdded:function(a,b,c){var d=this.mappedIndexes,e=0;if(b>0){var f=this.observables,g=!1;if(e=d[b-1],void 0===e){e=0;for(var h=0;b>h;h++)g&&e++,d.push(e),g=this.getVisibility(f[h])}else this.getVisibility(f[b-1])&&e++}if(d.splice(b,0,e),c){this.transformedArray.splice(e,0,a);for(var h=b+1,i=d.length;i>h;h++)d[h]++;this.changes.push({status:"added",index:e,value:a})}},valueDeleted:function(a,b,c){var d=this.mappedIndexes,e=d[b];if(d.splice(b,1),c){this.transformedArray.splice(e,1);for(var f=b,g=d.length;g>f;f++)d[f]--;this.changes.push({status:"deleted",index:e,value:a})}},valueMoved:function(a,b,c,d){if(this.valueDeleted(a,c,d),this.valueAdded(a,b,d),d){var e=this.changes,f=e.length,g=e[f-1],h=e[f-2];g.moved=h.index,h.moved=g.index}},valueMutated:function(a,b,c){b&&!c?this.valueAdded(a,g(a,this.original.peek()),!0):!b&&c&&this.valueDeleted(a,g(a,this.original.peek()),!0)},getVisibility:f}),l({name:"groupBy",init:function(){return this.groups=e(),this.groupKeys=[],a.observableArray([])},applyAndNotifyChanges:function(a){var d=this.groups,e=this.groupKeys;b(this,a);for(var f,g=0;f=e[g];g++){var h=d[f];c(h),0===h.transformedArray.length&&this.deleteGroup(h,f,g--)}c(this)},valueAdded:function(a,b,c){c+="";var d=this.groups,e=this.groupKeys,g=d[c];if(!g){g=new m.filter(this.original,null),d[c]=g,e.push(c),g.observables=this.observables,g.object={key:c,values:g.transform},g.getVisibility=function(a){return f(a)+""===c};var h=this.transformedArray;h.push(g.object),this.changes.push({status:"added",index:h.length-1,value:g.object})}for(var i,j=0;i=e[j];j++)d[i].valueAdded(a,b,i===c)},valueDeleted:function(a,b,c){c+="";for(var d,e=this.groups,f=this.groupKeys,g=0;d=f[g];g++)e[d].valueDeleted(a,b,d===c)},valueMoved:function(a,b,c,d){d+="";for(var e,f=this.groups,g=this.groupKeys,h=0;e=g[h];h++)f[e].valueMoved(a,b,c,e===d)},valueMutated:function(a,b,c){var d=this.groups,e=d[b],f=d[c],h=g(a,this.original.peek());e.valueAdded(a,h,!0),f.valueDeleted(a,h,!0),0===f.transformedArray.length&&this.deleteGroup(f,c,g(c,this.groupKeys))},deleteGroup:function(a,b,c){delete this.groups[b],this.groupKeys.splice(c,1);var d=this.transformedArray,e=g(a.object,d);d.splice(e,1),this.changes.push({status:"deleted",index:e,value:a.object})}}),l({name:"map",init:function(){return a.observableArray([])},valueAdded:function(a,b,c){this.transformedArray.splice(b,0,c),this.changes.push({status:"added",index:b,value:c})},valueDeleted:function(a,b,c){this.transformedArray.splice(b,1),this.changes.push({status:"deleted",index:b,value:c})},valueMoved:function(a,b,c,d){this.transformedArray.splice(c,1),this.transformedArray.splice(b,0,d),this.changes.push({status:"added",index:b,moved:c,value:d},{status:"deleted",index:c,moved:b,value:d})},valueMutated:function(a,b,c){var d=g(a,this.original.peek());this.transformedArray.splice(d,1,b),this.changes.push({status:"deleted",index:d,value:c},{status:"added",index:d,value:b})}});var n={init:function(){return this.truthinessCount=0,a.observable(this.getTruthiness())},valueAdded:function(a,b,c){this.valueMutated(null,c,!1)},valueDeleted:function(a,b,c){this.valueMutated(null,!1,c)},valueMoved:h,valueMutated:function(a,b,c){b&&!c?this.truthinessCount++:c&&!b&&this.truthinessCount--,this.transform(this.getTruthiness())}};l(a.utils.extend({name:"any",getTruthiness:function(){return this.truthinessCount>0}},n)),l(a.utils.extend({name:"all",getTruthiness:function(){return this.truthinessCount===this.observables.length}},n)),a.observableArray.fn.some=a.observableArray.fn.any,a.observableArray.fn.every=a.observableArray.fn.all,a.arrayTransforms={makeTransform:l}});